<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Bucket List</title>
<style>
  body { font-family: Arial, sans-serif; max-width: 600px; margin: auto; padding: 20px; }
  h1 { text-align: center; }
  ul { list-style: none; padding: 0; }
  li { margin-bottom: 8px; display: flex; align-items: center; justify-content: space-between; }
  label { cursor: pointer; flex: 1; }
  input[type="checkbox"] { margin-right: 10px; }
  button { margin: 5px 5px 15px 0; padding: 8px 12px; }
  .delete-btn {
    background: none;
    border: none;
    color: #cc0000;
    font-weight: bold;
    font-size: 18px;
    cursor: pointer;
    padding: 0 8px;
    user-select: none;
  }
  #userNameInput, #newItemInput { padding: 6px; width: 200px; }
  #newItemInput { margin-right: 5px; }
</style>
</head>
<body>

<div style="text-align:center; margin-bottom: 15px;">
  <input type="text" id="userNameInput" placeholder="Enter your name" />
  <button id="setNameBtn">Set Name</button>
</div>

<h1 id="titleHeader">My Bucket List ✅</h1>

<div style="margin-bottom: 15px; text-align:center;">
  <input type="text" id="newItemInput" placeholder="Add a new bucket list item" />
  <button id="addItemBtn">Add Item</button>
</div>

<div>
  <h2>Things to Do</h2>
  <ul id="todoList"></ul>
</div>

<div>
  <h2>Completed</h2>
  <ul id="completedList"></ul>
</div>

<button id="clearAllBtn">Clear All (Reset)</button>

<div style="margin-top: 20px; text-align:center;">
  <input type="file" id="importInput" accept=".txt" />
  <button id="exportImageBtn">Export as Image</button>
</div>

<script>
const defaultTodo = [
  "Make a standard chamoyada",
  "Make a standard matcha using tools",
  "Make coffee latte art with leaf pattern",
  "Turn off phone for 48 hours without contacting anyone",
  "Draw a self-portrait",
  "Wreck diving",
  "Get a seaman certificate",
  "Volunteer in Antarctica once",
  "Dive off a platform",
  "Learn Thomas spin (Thomas-style figure skating spin)",
  "Do 10 standard pull-ups",
  "Build “pumpkin shoulders”",
  "Travel around the world in 80 days",
  "Build a personal website and do SEO",
  "Develop and publish an app (iOS)",
  "Write 10 travelogues",
  "Learn meditation",
  "Publish a book/travelogue",
  "Make a movie",
  "Chat in Japanese all afternoon",
  "See Northern Lights and ski in Scandinavia",
  "Live in Japan for 3 months",
  "Learn a magic trick",
  "Pick mushrooms once",
  "Learn Morse code",
  "Skydive",
  "Jump off a bridge",
  "Volunteer far away",
  "Go on a campervan trip",
  "Fold an animal by origami",
  "Watch whales in the wild",
  "Learn juggling",
  "Ride a Harley with a passenger",
  "Drive a dune buggy",
  "Zipline once",
  "Plant a tree",
  "Learn to cook grilled fish, skewers, Sichuan cuisine",
  "Go deep-sea fishing with old friends and cook grilled fish",
  "Survive alone on a deserted island or catch mantis shrimp/lobster",
  "Experience level 10 loneliness",
  "Take a surprise trip (decide destination at airport)",
  "Explore a haunted house",
  "Roast marshmallows once",
  "Go to a carnival / running of the bulls / tomato festival",
  "Set up a street stall",
  "Successfully do a handstand or headstand",
  "Play “Diver Dave”",
  "Spend a night on a cliff (Peru)",
  "Dye hair pink / grey / rainbow / afro",
  "Fly a plane once",
  "Raise a chameleon",
  "Learn dermatology knowledge",
  "Learn nutrition and wellness coaching",
  "CPR + AED training",
  "Go on a food lover’s pilgrimage"
];

const defaultCompleted = [
  "Camped under dragon blood tree",
  "Rode a hot air balloon",
  "Went on safari",
  "Did bungee jumping",
  "White-water rafting",
  "Caught a fish",
  "Saw a castle",
  "Visited a cave",
  "Went to a desert",
  "Went to an active volcano",
  "Learned backflip",
  "Cliff diving"
];

const STORAGE_KEY = 'bucketListData';

let todoListData = [];
let completedListData = [];
let userName = '';

const todoListElem = document.getElementById('todoList');
const completedListElem = document.getElementById('completedList');
const clearAllBtn = document.getElementById('clearAllBtn');
const userNameInput = document.getElementById('userNameInput');
const setNameBtn = document.getElementById('setNameBtn');
const titleHeader = document.getElementById('titleHeader');
const importInput = document.getElementById('importInput');
const exportImageBtn = document.getElementById('exportImageBtn');
const newItemInput = document.getElementById('newItemInput');
const addItemBtn = document.getElementById('addItemBtn');

function saveData() {
  localStorage.setItem(STORAGE_KEY, JSON.stringify({
    todo: todoListData,
    completed: completedListData,
    userName: userName
  }));
}

function loadData() {
  const saved = localStorage.getItem(STORAGE_KEY);
  if (saved) {
    try {
      const obj = JSON.parse(saved);
      todoListData = obj.todo && obj.todo.length ? obj.todo : [...defaultTodo];
      completedListData = obj.completed && obj.completed.length ? obj.completed : [...defaultCompleted];
      userName = obj.userName || '';
      if (userName) {
        titleHeader.textContent = `${userName}'s Bucket List ✅`;
        userNameInput.value = userName;
      } else {
        titleHeader.textContent = `My Bucket List ✅`;
      }
    } catch {
      todoListData = [...defaultTodo];
      completedListData = [...defaultCompleted];
      userName = '';
      titleHeader.textContent = `My Bucket List ✅`;
    }
  } else {
    todoListData = [...defaultTodo];
    completedListData = [...defaultCompleted];
    userName = '';
    titleHeader.textContent = `My Bucket List ✅`;
  }
}

function createListItem(text, index, completed) {
  const li = document.createElement('li');

  const checkbox = document.createElement('input');
  checkbox.type = 'checkbox';
  checkbox.checked = completed;
  checkbox.id = (completed ? 'completed_' : 'todo_') + index;
  checkbox.addEventListener('change', () => {
    if (checkbox.checked) {
      if (!completed) {
        completedListData.push(text);
        todoListData.splice(index, 1);
      }
    } else {
      if (completed) {
        todoListData.push(text);
        completedListData.splice(index, 1);
      }
    }
    sortAndSave();
    renderLists();
  });

  const label = document.createElement('label');
  label.htmlFor = checkbox.id;
  label.textContent = text;
  label.style.flex = '1';

  const delBtn = document.createElement('button');
  delBtn.textContent = '×';
  delBtn.className = 'delete-btn';
  delBtn.title = 'Delete this item';
  delBtn.addEventListener('click', () => {
    if (completed) {
      completedListData.splice(index, 1);
    } else {
      todoListData.splice(index, 1);
    }
    sortAndSave();
    renderLists();
  });

  li.appendChild(checkbox);
  li.appendChild(label);
  li.appendChild(delBtn);

  return li;
}

function sortAndSave() {
  todoListData = [...new Set(todoListData)];
  completedListData = [...new Set(completedListData)];
  saveData();
}

function renderLists() {
  todoListElem.innerHTML = '';
  completedListElem.innerHTML = '';

  todoListData.forEach((item, idx) => {
    const li = createListItem(item, idx, false);
    li.querySelector('label').textContent = `${idx + 1}. ${item}`;
    todoListElem.appendChild(li);
  });

  completedListData.forEach((item, idx) => {
    const li = createListItem(item, idx, true);
    li.querySelector('label').textContent = `${idx + 1}. ${item}`;
    completedListElem.appendChild(li);
  });
}

setNameBtn.addEventListener('click', () => {
  const name = userNameInput.value.trim();
  userName = name;
  if (name) {
    titleHeader.textContent = `${name}'s Bucket List ✅`;
  } else {
    titleHeader.textContent = `My Bucket List ✅`;
  }
  saveData();
});

clearAllBtn.addEventListener('click', () => {
  todoListData = [...defaultTodo];
  completedListData = [...defaultCompleted];
  userName = '';
  userNameInput.value = '';
  titleHeader.textContent = `My Bucket List ✅`;
  saveData();
  renderLists();
});

addItemBtn.addEventListener('click', () => {
  const newItem = newItemInput.value.trim();
  if (newItem) {
    todoListData.push(newItem);
    newItemInput.value = '';
    sortAndSave();
    renderLists();
  }
});

importInput.addEventListener('change', (e) => {
  const file = e.target.files[0];
  if (!file) return;
  const reader = new FileReader();
  reader.onload = () => {
    const text = reader.result;
    parseImportedText(text);
    renderLists();
  };
  reader.readAsText(file);
  importInput.value = '';
});

function parseImportedText(text) {
  const lines = text.split(/\r?\n/).map(l => l.trim()).filter(l => l.length > 0);
  let newUserName = '';
  let todoImported = [];
  let completedImported = [];
  let currentSection = '';
  for (let line of lines) {
    if (line.toLowerCase().includes('bucketlist')) {
      const match = line.match(/^(.+?)'s bucketlist/i);
      if (match) newUserName = match[1];
      continue;
    }
    if (line.toLowerCase().startsWith('things to do')) {
      currentSection = 'todo';
      continue;
    }
    if (line.toLowerCase().startsWith('completed')) {
      currentSection = 'completed';
      continue;
    }
    if (currentSection === 'todo') {
      line = line.replace(/^\d+\.\s*/, '');
      todoImported.push(line);
    } else if (currentSection === 'completed') {
      line = line.replace(/^\d+\.\s*/, '');
      completedImported.push(line);
    }
  }
  if (todoImported.length > 0) todoListData = todoImported;
  if (completedImported.length > 0) completedListData = completedImported;
  if (newUserName) {
    userName = newUserName;
    userNameInput.value = newUserName;
    titleHeader.textContent = `${userName}'s Bucket List ✅`;
  }
  sortAndSave();
}

function exportToImage() {
  const canvas = document.createElement('canvas');
  const ctx = canvas.getContext('2d');
  const padding = 20;
  const lineHeight = 24;
  const width = 600;
  const titleHeight = 40;
  const dateHeight = 20;
  const sectionTitleHeight = 30;
  const todoHeight = todoListData.length * lineHeight;
  const completedHeight = completedListData.length * lineHeight;
  const height = padding*2 + titleHeight + dateHeight + sectionTitleHeight*2 + todoHeight + completedHeight + 40;

  canvas.width = width;
  canvas.height = height;

  ctx.fillStyle = '#fff';
  ctx.fillRect(0, 0, width, height);

  ctx.fillStyle = '#000';
  ctx.font = 'bold 24px Arial';
  ctx.textBaseline = 'top';
  ctx.fillText(`${userName ? userName + "'s" : 'My'} Bucket List ✅`, padding, padding);

  const today = new Date();
  const dateStr = today.toLocaleDateString();
  ctx.font = '14px Arial';
  ctx.fillText(`Exported on: ${dateStr}`, padding, padding + titleHeight);

  ctx.font = 'bold 18px Arial';
  ctx.fillText('Things to Do:', padding, padding + titleHeight + dateHeight + 10);

  ctx.font = '16px Arial';
  todoListData.forEach((item, i) => {
    ctx.fillText(`${i+1}. ${item}`, padding + 10, padding + titleHeight + dateHeight + sectionTitleHeight + i * lineHeight);
  });

  const completedY = padding + titleHeight + dateHeight + sectionTitleHeight + todoHeight + 40;
  ctx.font = 'bold 18px Arial';
  ctx.fillText('Completed:', padding, completedY);

  ctx.font = '16px Arial';
  completedListData.forEach((item, i) => {
    ctx.fillText(`${i+1}. ${item}`, padding + 10, completedY + sectionTitleHeight + i * lineHeight);
  });

  const link = document.createElement('a');
  link.download = `bucketlist_${(userName || 'my').replace(/\s+/g,'_').toLowerCase()}_${dateStr.replace(/\//g,'-')}.png`;
  link.href = canvas.toDataURL('image/png');
  link.click();
}

exportImageBtn.addEventListener('click', exportToImage);

loadData();
renderLists();

</script>
</body>
</html>
